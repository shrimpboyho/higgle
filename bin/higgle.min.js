!function(){function HiggleCollection(){Array.call(this,arguments)}function checkCall(cb,arg){return cb?(cb(arg),void 0):arg}HiggleCollection.prototype=[],HiggleCollection.prototype.each=function(callback){return this.forEach(callback)},HiggleCollection.prototype.clear=function(){for(;this.length>0;)this.pop()},HiggleCollection.prototype.insert=function(element){this.push(element)},HiggleCollection.prototype.matchQuery=function(doc,query){var k,i,queryKeys=Object.keys(query),docKeys=Object.keys(doc),queryKeysNum=queryKeys.length,queryValues=[],docValues=[],buffer=[];for(i=0;i<queryKeys.length;i++)queryValues.push(query[queryKeys[i]]);for(i=0;i<docKeys.length;i++)docValues.push(doc[docKeys[i]]);var len=docKeys.length;for(i=0;len>i;i++)for(k=0;k<queryKeys.length;k++)if(docKeys[i]==queryKeys[k]){var dvalue=docValues[i],qvalue=queryValues[k];if(typeof dvalue!=typeof qvalue&&"HiggleOp"!==qvalue.constructor.name)continue;if(typeof dvalue!=typeof qvalue&&"HiggleOp"===qvalue.constructor.name)"less"===qvalue.type&&dvalue<qvalue.less&&buffer.push(!0),"great"===qvalue.type&&dvalue>qvalue.great&&buffer.push(!0),"range"===qvalue.type&&dvalue>lower&&upper>dvalue&&buffer.push(!0);else{var type=typeof qvalue;Array.isArray(qvalue)?JSON.stringify(qvalue)===JSON.stringify(dvalue)&&buffer.push(!0):"object"===type&&JSON.stringify(qvalue)===JSON.stringify(dvalue)&&buffer.push(!0),qvalue===dvalue&&buffer.push(!0)}}return buffer.length===queryKeysNum?!0:!1},HiggleCollection.prototype.find=function(query,callback){if(query&&"{}"!==JSON.stringify(query)){var i,result=new HiggleCollection;for(i=0;i<this.length;i++){var currentDoc=this[i];result.matchQuery(currentDoc,query)&&result.push(currentDoc)}return 0!==result.length?checkCall(callback,result):checkCall(callback,!1)}return this},this.Higgle=function(){this.collections=[]},Higgle.prototype.createCollection=function(name){var k=new HiggleCollection;this.collections.push([name,k])},Higgle.prototype.collection=function(name,callback){var i;for(i=0;i<this.collections.length;i++)if(name==this.collections[i][0])return checkCall(callback,this.collections[i][1]);return checkCall(callback,!1)},Higgle.prototype.close=function(){return!0},Higgle.prototype.dump=function(name){require("fs").writeFile(name,JSON.stringify(this.collections),function(err){if(err)throw err})},Higgle.prototype.load=function(name,cb){require("fs").readFile(name,"utf8",function(err,buffer){if(err)throw err;var newone=new Higgle;newone.collections=JSON.parse(buffer),cb(newone)})},this.HiggleOp=function(type){this.type=type},HiggleOp.prototype.setLess=function(less){this.less=less},HiggleOp.prototype.setGreat=function(great){this.great=great},HiggleOp.prototype.setRange=function(lower,upper){this.lower=lower,this.upper=upper},this.less=function(num){var op=new HiggleOp("less");return op.setLess(num),op},this.great=function(num){var op=new HiggleOp("great");return op.setGreat(num),op},this.range=function(lower,upper){var op=new HiggleOp("range");return op.setRange(lower,upper),op}}(this),"undefined"!=typeof exports&&(module.exports=Higgle);